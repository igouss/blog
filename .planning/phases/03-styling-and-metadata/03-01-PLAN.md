---
phase: 03-styling-and-metadata
plan: "01"
type: execute
wave: 1
depends_on: []
files_modified:
  - css/blog.css
  - templates/article.html
autonomous: true
requirements: [STYL-01, STYL-02, STYL-03, META-01]

must_haves:
  truths:
    - "Article pages render with SARA warm typography — Nunito font, 18px base, 1.8 line-height, #5a534a text on #faf8f5 background"
    - "A visible '← Back' link appears inline above the article h1, linking to /"
    - "Pages are mobile-usable: no horizontal scroll at 375px viewport, readable font size"
    - "curl -s <article-url> | grep og:title returns a populated og:title tag from front matter"
    - "Dark mode works via system preference AND a JS toggle button that persists to localStorage"
  artifacts:
    - path: "css/blog.css"
      provides: "SARA-styled blog CSS with light/dark variables, typography, layout, responsive, reduced-motion"
      min_lines: 120
    - path: "templates/article.html"
      provides: "Updated template with Nunito Google Fonts import, og:title meta, Back nav link, theme toggle button+JS"
  key_links:
    - from: "templates/article.html"
      to: "css/blog.css"
      via: "<link rel=stylesheet href=/css/blog.css>"
      pattern: 'href="/css/blog\.css"'
    - from: "templates/article.html"
      to: "article front matter"
      via: "og:title content={{$doc.Meta.title}}"
      pattern: 'og:title.*Meta\.title'
    - from: "css/blog.css"
      to: "[data-theme=dark]"
      via: "CSS custom property overrides for dark variant"
      pattern: '\[data-theme="dark"\]'
    - from: "inline JS in article.html"
      to: "localStorage"
      via: "reads blog-theme key, sets data-theme on <html>"
      pattern: "localStorage.*blog-theme"
---

<objective>
Write css/blog.css (full SARA design language implementation for a reading-focused blog) and update templates/article.html to add: Google Fonts Nunito import, Open Graph og:title meta tag, a "← Back" navigation link, and an inline theme toggle script+button.

Purpose: Transform the unstyled Phase 2 HTML into a warm, readable blog with dark/light mode support and proper social metadata.
Output: css/blog.css (new file), templates/article.html (updated)
</objective>

<execution_context>
@/home/elendal/.claude/get-shit-done/workflows/execute-plan.md
@/home/elendal/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-rendering-pipeline/02-02-SUMMARY.md
@web_design_look_and_feel.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Write css/blog.css — SARA-styled reading layout with dark/light mode</name>
  <files>css/blog.css</files>
  <action>
Create css/blog.css from scratch. This is a new file (currently empty placeholder .gitkeep exists, blog.css does not). Implement the SARA design language for a reading-focused personal blog. Exact specifications:

**CSS custom properties on :root (light mode defaults):**
- --bg-primary: #faf8f5
- --bg-secondary: #f0ebe4
- --text-primary: #5a534a
- --text-secondary: #7a6f63
- --text-tertiary: #9a8f82
- --accent: #d4c4b0
- --accent-hover: #c4b4a0
- --shadow-sm: 0 2px 8px rgba(90, 83, 74, 0.05)
- --shadow-md: 0 4px 15px rgba(90, 83, 74, 0.08)
- --radius-md: 12px
- --radius-lg: 16px
- --ease-soft: cubic-bezier(0.25, 0.46, 0.45, 0.94)

**Dark mode via [data-theme="dark"] selector (overrides custom properties — NOT prefers-color-scheme alone, because JS toggle also writes this attribute):**
- --bg-primary: #2a2520
- --bg-secondary: #332e28
- --text-primary: #e8e0d5
- --text-secondary: #c4b8a8
- --text-tertiary: #9a8f82
- --accent: #6b5e4e
- --accent-hover: #7a6d5c
- --shadow-md: 0 4px 15px rgba(0, 0, 0, 0.3)

Also add: `@media (prefers-color-scheme: dark) { :root:not([data-theme="light"]) { /* same dark vars */ } }` so system preference works before JS runs.

**Global reset and base:**
- box-sizing: border-box on *, margin: 0, padding: 0
- html: font-size: 18px (user decision override of SARA 14px base)
- body: font-family: 'Nunito', 'Segoe UI', sans-serif; background: var(--bg-primary); color: var(--text-primary); line-height: 1.8; min-height: 100vh; transition: background 0.4s var(--ease-soft), color 0.4s var(--ease-soft)

**Layout — article reading column:**
- body > main: max-width: 80ch; margin: 0 auto; padding: 40px 20px (multiples of 5px; 20px for mobile edge padding)
- article: width: 100%

**Navigation — back link (.back-nav):**
- display: inline-flex; align-items: center; gap: 5px
- color: var(--text-tertiary); text-decoration: none; font-size: 0.85rem; letter-spacing: 1px
- padding: 5px 10px; border-radius: var(--radius-md)
- margin-bottom: 25px; display: block (inline-flex wrapping block for standalone line)
- transition: all 0.3s var(--ease-soft)
- :hover: color: var(--text-primary); background: var(--bg-secondary)

**Article header:**
- article header: margin-bottom: 40px
- h1: font-size: 2rem; font-weight: 300 (SARA: light for page titles); letter-spacing: 2px; color: var(--text-secondary); line-height: 1.3; margin-bottom: 10px
- time: font-size: 0.75rem; color: var(--text-tertiary); letter-spacing: 2px

**Article body typography (selectors inside article):**
- p: margin-bottom: 1.5rem; color: var(--text-primary)
- h2, h3, h4: font-weight: 600 (SARA: medium for section titles, never 700+); color: var(--text-secondary); letter-spacing: 1px; margin: 2rem 0 0.75rem
- h2: font-size: 1.4rem; h3: font-size: 1.15rem
- a: color: var(--text-secondary); text-underline-offset: 3px; transition: color 0.3s
- a:hover: color: var(--text-primary)
- blockquote: border-left: 3px solid var(--accent); padding-left: 20px; margin: 1.5rem 0; color: var(--text-secondary); font-style: italic
- code (inline): background: var(--bg-secondary); padding: 2px 6px; border-radius: 6px; font-size: 0.85em; color: var(--text-secondary)
- pre: background: var(--bg-secondary); padding: 20px; border-radius: var(--radius-lg); overflow-x: auto; margin: 1.5rem 0; box-shadow: var(--shadow-sm)
- pre code: background: none; padding: 0; font-size: 0.85rem; line-height: 1.6
- ul, ol: padding-left: 1.5rem; margin-bottom: 1.5rem
- li: margin-bottom: 5px
- hr: border: none; border-top: 1px solid var(--bg-secondary); margin: 2rem 0

**Theme toggle button (#theme-toggle):**
- position: fixed; top: 20px; right: 20px
- width: 40px; height: 40px; border-radius: 50%
- background: var(--bg-secondary); border: none; cursor: pointer
- display: flex; align-items: center; justify-content: center; font-size: 1rem
- box-shadow: var(--shadow-md); transition: all 0.3s var(--ease-soft)
- :hover: transform: scale(1.1); box-shadow: var(--shadow-md) (deepen via opacity trick or use shadow-lg)
- color: var(--text-tertiary)

**Mobile responsiveness (@media (max-width: 640px)):**
- body > main: padding: 20px 15px (tighter side padding on small screens)
- h1: font-size: 1.5rem; letter-spacing: 1px
- #theme-toggle: top: 15px; right: 15px; width: 36px; height: 36px
- No horizontal overflow: ensure pre has overflow-x: auto (already set above)

**Reduced motion:**
```css
@media (prefers-reduced-motion: reduce) {
  *, *::before, *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}
```

Do NOT use pure #ffffff or #000000 anywhere. Do NOT use font-weight 700+. All shadows use rgba(90, 83, 74, …) base for warm tones.
  </action>
  <verify>
1. File exists: `ls -la /srv/blog/css/blog.css` (or project path equivalent)
2. CSS validates structurally: `grep -c "var(--" css/blog.css` returns ≥ 15 (confirms variables used throughout)
3. Dark mode selector present: `grep "\[data-theme" css/blog.css` returns matches
4. Reduced-motion block present: `grep "prefers-reduced-motion" css/blog.css`
5. Mobile media query present: `grep "max-width" css/blog.css`
  </verify>
  <done>css/blog.css exists with SARA variables, dark/light mode, reading layout, back-nav styles, theme toggle styles, mobile responsive styles, and reduced-motion block. No #000000 or #ffffff in large-background contexts. No font-weight ≥ 700.</done>
</task>

<task type="auto">
  <name>Task 2: Update templates/article.html — Nunito font, og:title, back nav, theme toggle JS</name>
  <files>templates/article.html</files>
  <action>
Update the existing templates/article.html. Current state (856 bytes, from Phase 2):
```
{{$origPath := .OriginalReq.URL.Path}}
... (path/frontmatter logic) ...
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{$doc.Meta.title}}</title>
  <link rel="stylesheet" href="/css/blog.css">
  <link rel="stylesheet" href="/css/syntax.css">
</head>
<body>
  <main>
    <article>
      <header>
        <h1>{{$doc.Meta.title}}</h1>
        <time datetime="{{$doc.Meta.date}}">{{$doc.Meta.date}}</time>
      </header>
      {{markdown $doc.Body}}
    </article>
  </main>
</body>
</html>
```

Make the following changes:

1. **Add Google Fonts Nunito import** — add before the existing stylesheet links in `<head>`:
   ```html
   <link rel="preconnect" href="https://fonts.googleapis.com">
   <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
   <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600&display=swap" rel="stylesheet">
   ```
   Load weights 300, 400, 600 only (SARA: never 700+).

2. **Add Open Graph og:title meta tag** — add after the `<title>` tag:
   ```html
   <meta property="og:title" content="{{$doc.Meta.title}}">
   <meta property="og:type" content="article">
   ```
   og:type: article is trivially small per user decision ("Claude may add og:type if trivially small").

3. **Add theme toggle inline script** — add immediately after `<head>` opens (before any other tags, to avoid FOUC — Flash Of Unstyled Content for theme):
   ```html
   <script>
     (function() {
       var saved = localStorage.getItem('blog-theme');
       if (saved) {
         document.documentElement.setAttribute('data-theme', saved);
       } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
         document.documentElement.setAttribute('data-theme', 'dark');
       }
     })();
   </script>
   ```
   This IIFE runs before CSS renders, preventing FOUC.

4. **Add "← Back" navigation link** — add inside `<body>` before `<main>` or as first child of `<main>`, before `<article>`:
   ```html
   <a href="/" class="back-nav">← Back</a>
   ```
   Per user decision: inline above the article title, not a full header bar.

5. **Add theme toggle button + click handler JS** — add before `</body>`:
   ```html
   <button id="theme-toggle" aria-label="Toggle theme" title="Toggle light/dark mode">◐</button>
   <script>
     var btn = document.getElementById('theme-toggle');
     function updateIcon() {
       btn.textContent = document.documentElement.getAttribute('data-theme') === 'dark' ? '◑' : '◐';
     }
     updateIcon();
     btn.addEventListener('click', function() {
       var current = document.documentElement.getAttribute('data-theme');
       var next = current === 'dark' ? 'light' : 'dark';
       document.documentElement.setAttribute('data-theme', next);
       localStorage.setItem('blog-theme', next);
       updateIcon();
     });
   </script>
   ```
   Uses ◐/◑ SARA symbol choices (from web_design_look_and_feel.md symbol list). localStorage key: 'blog-theme' (Claude's choice, simple and descriptive).

The IIFE anti-FOUC script must be the FIRST thing inside `<head>`, even before charset — though placing it after charset/viewport metas is acceptable since those don't affect rendering. Place after `<meta charset>` and `<meta name="viewport">` for correctness but before the `<link>` tags.

Preserve ALL existing Caddy template logic (the $origPath/$mdPath/fileExists/splitFrontMatter block at the top — do not touch that).
  </action>
  <verify>
1. og:title present: `grep "og:title" templates/article.html` returns `<meta property="og:title" content="{{$doc.Meta.title}}">`
2. Nunito font loaded: `grep "Nunito" templates/article.html` returns the Google Fonts link
3. Back nav present: `grep "back-nav" templates/article.html` returns the anchor tag
4. Theme toggle button present: `grep "theme-toggle" templates/article.html` returns both the button and the script
5. Anti-FOUC script present: `grep "blog-theme" templates/article.html` returns ≥ 2 matches (IIFE + click handler)
6. Caddy template logic intact: `grep "splitFrontMatter" templates/article.html` still returns the front matter line
7. Caddy serves the updated template without error: `curl -s -o /dev/null -w "%{http_code}" http://localhost:2019/` or check Caddy logs show no template parse errors after reload
  </verify>
  <done>templates/article.html has: Nunito Google Fonts import (weights 300/400/600), og:title + og:type meta tags populated from front matter, anti-FOUC theme IIFE, "← Back" link with class back-nav, theme toggle button (◐/◑) with localStorage persistence. All original Caddy template logic preserved. Caddy parses template without errors.</done>
</task>

</tasks>

<verification>
After both tasks complete:

1. **Typography check:** Load any article URL in browser — page should show Nunito font (check via DevTools), warm cream background, readable 18px text with generous spacing.
2. **Back nav check:** `curl -s <article-url> | grep "back-nav"` returns the anchor.
3. **Mobile check:** `curl -s <article-url> | grep "max-width"` returns the media query (via blog.css link; visual check needed for actual mobile experience — covered in Plan 02).
4. **OG check:** `curl -s <article-url> | grep og:title` returns `<meta property="og:title" content="[article title]">`.
5. **Dark mode CSS check:** `grep -c 'data-theme' css/blog.css` ≥ 1.
6. **Caddy health:** `curl -s -o /dev/null -w "%{http_code}" <article-url>` returns 200 (not 500 from template errors).
</verification>

<success_criteria>
- css/blog.css exists with ≥ 120 lines, SARA variables, dark/light mode, reading layout, mobile responsive
- templates/article.html includes og:title, Nunito font, back-nav link, theme toggle button + scripts
- curl -s <article-url> | grep og:title returns populated meta tag
- Caddy serves articles as 200 (no template parse errors)
</success_criteria>

<output>
After completion, create `.planning/phases/03-styling-and-metadata/03-01-SUMMARY.md`
</output>
